<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Value Tests</title>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.15.0.css">
		<script src="http://code.jquery.com/qunit/qunit-1.15.0.js"></script>
		<script src="../src/Registry.js"></script>
		<script src="../src/Subscriber.js"></script>
		<script src="../src/BindingRoot.js"></script>
		<script src="../src/Binding.js"></script>
		<script src="../src/Datum.js"></script>
		<script src="../src/Text.js"></script>
		<script src="../src/Value.js"></script>
	</head>
	<body>
		<style>
			#qunit ~ * {
					display: none;
			}
		</style>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
		<input type="text" id="test-input" data-bind="input" />
		<script>
      query = function(query) {

          return document.querySelector(query);
      };

			scope = document.querySelector("body");
	
			QUnit.test("Bind value", function(assert) {

					var input = new Value("Hello World");

					input.bind(scope, "input");

					assert.strictEqual(query("#test-input").value, "Hello World");
			});
		</script>
		<input type="text" id="value-input" data-bind="valueInput" />
		<script>
			QUnit.test("Update data from input", function(assert) {

					var datum = new Datum();

					var valueInput = new Value(datum);

					valueInput.bind(scope, "valueInput");

					var element = query("#value-input");

					element.value = "Hello World";
					element.dispatchEvent(new Event("change"));

					assert.strictEqual(datum(), "Hello World");
			});
		</script>
		<input type="text" id="input" data-bind="testInput" />
		<script>
			QUnit.test("Bind value from datum", function(assert) {

					var datum = new Datum("Hello World")

					var input = new Value(datum);

					input.bind(scope, "testInput");

					assert.strictEqual(query("#input").value, "Hello World");
			});
		</script>
		<input type="text" id="input-value" data-bind="inputValue" />
		<script>
			QUnit.test("Change value after binding", function(assert) {

					var datum = new Datum()

					var input = new Value(datum);

					input.bind(scope, "inputValue");

					datum("Hello World");

					assert.strictEqual(query("#input-value").value, "Hello World");
			});
		</script>
		<input type="text" id="input1" data-bind="multiInput" />
		<input type="text" id="input2" data-bind="multiInput" />
		<script>
			QUnit.test("Bind value to two inputs", function(assert) {

					var input = new Value("Hello World");

					input.bind(scope, "multiInput");

					assert.strictEqual(query("#input1").value, "Hello World");
					assert.strictEqual(query("#input2").value, "Hello World");
			});
		</script>
		<input type="text" id="send" data-bind="sync" />
		<input type="text" id="receive" data-bind="sync" />
		<script>
			QUnit.test("Synchronise inputs", function(assert) {

					var datum = new Datum();

					var valueInput = new Value(datum);

					valueInput.bind(scope, "sync");

					var sender = query("#send");

					sender.value = "Hello World";
					sender.dispatchEvent(new Event("change"));

					assert.strictEqual(query("#receive").value, "Hello World");
			});
		</script>
    <input type="text" data-bind="single" />
    <input type="text" data-bind="single" />
    <script>
      QUnit.test("Callback called once on init", function(assert) {

          var count = 0;

          var datum = new Datum();

          var value = 
              new Value(function() {

                  count += 1; 

                  return datum();
              });

          value.bind(scope, "single");

          assert.strictEqual(count, 1);
      });
    </script>
  	<div data-bind="twice"></div>
    <div data-bind="twice"></div>
    <script>
      QUnit.test("Callback called once on update", function(assert) {

          var count = 0;

          var datum = new Datum();

          var value = 
              new Value(function() {

                  count += 1; 

                  return datum();
              });

          value.bind(scope, "twice");

          count = 0;

          datum("Hello World");

          assert.strictEqual(count, 1);
      });
    </script>
	</body>
</html>
