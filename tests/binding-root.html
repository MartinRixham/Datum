<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Binding Root Tests</title>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.15.0.css">
		<script src="http://code.jquery.com/qunit/qunit-1.15.0.js"></script>
		<script src="../src/Registry.js"></script>
		<script src="../src/Subscriber.js"></script>
		<script src="../src/BindingRoot.js"></script>
		<script src="../src/Binding.js"></script>
		<script src="../src/Datum.js"></script>
		<script src="../src/Text.js"></script>
		<script src="../src/Value.js"></script>
	</head>
	<body>
		<style>
			#qunit ~ * {
					display: none;
			}
		</style>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
		<script>
			query = function(query) {

					return document.querySelector(query);
			};
		</script>
		<div id="test-div" data-bind="test"></div>
		<script>
			QUnit.test("Bind text", function(assert) {

					function TextObject() {
		
							this.test = new Binding({

									text: "Hello World"
							});
					}

					new BindingRoot(new TextObject());

					assert.strictEqual(query("#test-div").innerHTML, "Hello World");
			});
		</script>
		<input type="text" id="test-input" data-bind="input" />
		<script>
			QUnit.test("Bind value", function(assert) {

					function InputObject() {

							this.input = new Binding({

									value: "Hello World"
							});
					}

					new BindingRoot(new InputObject());

					assert.strictEqual(query("#test-input").value, "Hello World");
			});
		</script>
		<input type="text" id="value-input" data-bind="valueInput" />
		<script>
			QUnit.test("Update data from input", function(assert) {

					function InputObject() {

							this.datum = new Datum();

							this.valueInput = new Binding({

									value: this.datum
							});
					}

					var input = new InputObject();

					new BindingRoot(input);

					var element = query("#value-input");

					element.value = "Hello World";
					element.dispatchEvent(new Event("change"));

					assert.strictEqual(input.datum(), "Hello World");
			});
		</script>
		<div data-bind="super">
			<div id="sub" data-bind="sub"></div>
		</div>
		<script>
			QUnit.test("Bind subobject", function(assert) {

					function TextObject() {

							this.super = {

									sub: new Binding({

											text: "Hello World"
									})
							};
					}

					new BindingRoot(new TextObject());

					assert.strictEqual(query("#sub").innerHTML, "Hello World");
			});
		</script>
		<div data-bind="nonSuper"></div>
		<div id="non-sub" data-bind="nonSub"></div>
		<script>
			QUnit.test("Fail to bind subobject outside of scope", function(assert) {

					function TextObject() {

							this.nonSuper = {

									nonSub: new Binding({

											text: "Hello World"
									})
							};
					}

					new BindingRoot(new TextObject());

					assert.notEqual(query("#non-sub").innerHTML, "Hello World");
			});
		</script>
    <div id="plain" data-bind="plain"></div>
    <script>
      QUnit.test("Update text from plain object", function(assert) {

					function PlainObject() {

          		this.datum = null;

							var self = this;

          		this.plain = new Binding({

									text: function() { return self.datum; }
							});
					}

					plainObject = new PlainObject();

					new BindingRoot(plainObject);

          plainObject.datum = "Hello World";

          assert.strictEqual(query("#plain").innerHTML, "Hello World");
      });
    </script>
    <input type="text" id="plainValue" data-bind="plainValue" />
    <script>
      QUnit.test("Update value from plain object", function(assert) {

					function PlainObject() {

          		this.datum = null;

							var self = this;

          		this.plainValue = new Binding({

									value: function() { return self.datum; }
							});
					}

					plainObject = new PlainObject();

					new BindingRoot(plainObject);

          plainObject.datum = "Hello World";

          assert.strictEqual(query("#plainValue").value, "Hello World");
      });
    </script>
		<input type="text" id="plain-change" data-bind="plainChange" />
		<script>
			QUnit.test("Update plain data from input", function(assert) {

					function InputObject() {

							this.datum = null;

							var self = this;

							this.plainChange = new Binding({

									value: function(value) { 
	
											if (value) {

													self.datum = value; 
											}
											
											return self.datum;
									}
							});
					}

					var input = new InputObject();

					new BindingRoot(input);

					var element = query("#plain-change");

					element.value = "Hello World";
					element.dispatchEvent(new Event("change"));

					assert.strictEqual(input.datum, "Hello World");
			});
		</script>
	</body>
</html>
