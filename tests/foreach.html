<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>For Each Tests</title>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.16.0.css">
		<script src="http://code.jquery.com/qunit/qunit-1.16.0.js"></script>
		<script src="../src/Registry.js"></script>
		<script src="../src/Subscriber.js"></script>
		<script src="../src/UniqueRoot.js"></script>
		<script src="../src/BindingRoot.js"></script>
		<script src="../src/Binding.js"></script>
		<script src="../src/Datum.js"></script>
		<script src="../src/Text.js"></script>
		<script src="../src/Value.js"></script>
	</head>
	<body>
		<style>
			#qunit ~ * {
					display: none;
			}
		</style>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
		<script>
			var query = function(query) {

					return document.querySelector(query);
			};

			QUnit.module("", {

					teardown: function() {

							Subscriber.prototype = new Registry();
							Binding.prototype = new Subscriber();
							Datum.prototype = new Subscriber();
							Text.prototype = new Subscriber();
							Value.prototype = new Subscriber();
							UniqueRoot.prototype = new Subscriber();
							BindingRoot.prototype = new UniqueRoot();
					}
			});
		</script>
		<div id="each" data-bind="each">
			<div id="inner-each"></div>
		</div>
		<script>
			QUnit.test("Remove element when bound to empty array", function(assert) {

					function ForeachObject() {
		
							this.each = [];
					}

					var element = query("#each");

					var inner = query("#inner-each");

					var each = new ForeachObject();

					var root = new BindingRoot(each);

					assert.ok(!element.contains(inner));

					root.disconnect();
			});
		</script>
		<div id="one" data-bind="one">
			<div id="inner-one"></div>
		</div>
		<script>
			QUnit.test("One element when array length one", function(assert) {

					function OneObject() {
		
							this.one = [{}];
					}

					var one = new OneObject();

					var root = new BindingRoot(one);

					var element = query("#one");

					var inner = query("#inner-one");

					assert.ok(element.contains(inner));

					root.disconnect();
			});
		</script>
		<div id="two" data-bind="two">
			<div class="two"></div>
		</div>
		<script>
			QUnit.test("Two elements when array length two", function(assert) {

					function TwoObject() {
		
							this.two = [{}, {}];
					}

					var two = new TwoObject();

					var root = new BindingRoot(two);

					var element = query("#two");

					var childCount = element.querySelectorAll(".two").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="remove" data-bind="remove">
			<div id="remove-one"></div>
		</div>
		<script>
			QUnit.test("Remove elements when array set to null", function(assert) {

					function RemoveObject() {
		
							this.remove = [{}];
					}

					var remove = new RemoveObject();

					var element = query("#remove");

					var root = new BindingRoot(remove);

					remove.remove = null;

					assert.strictEqual(element.children.length, 0);

					root.disconnect();
			});
		</script>
		<div id="after" data-bind="after">
			<div class="after"></div>
		</div>
		<script>
			QUnit.test("Bind array after root", function(assert) {

					function AfterObject() {
		
							this.after = null;
					}

					var after = new AfterObject();

					var root = new BindingRoot(after);

					after.after = [{}, {}];

					var element = query("#after");

					var childCount = element.querySelectorAll(".after").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="reassign" data-bind="reassign">
			<div class="reassign"></div>
		</div>
		<script>
			QUnit.test("Reassign array", function(assert) {

					function ReassignObject() {
		
							this.reassign = [{}, {}];
					}

					var reassign = new ReassignObject();

					var root = new BindingRoot(reassign);

					reassign.reassign = [{}, {}];

					var element = query("#reassign");

					var childCount = element.querySelectorAll(".reassign").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="remove-all" data-bind="removeAll">
			<div id="removeOne"></div>
			<div id="removeTwo"></div>
		</div>
		<script>
			QUnit.test(
					"Remove all elements when bound to empty array",
					function(assert) {

							function RemoveAll() {
		
									this.removeAll = [];
							}

							var element = query("#remove-all");

							var each = new RemoveAll();

							var root = new BindingRoot(each);

							assert.strictEqual(element.children.length, 0);

							root.disconnect();
					});
		</script>
		<div id="all" data-bind="all">
			<div id="allOne"></div>
			<div id="allTwo"></div>
		</div>
		<script>
			QUnit.test("All elements when array length one", function(assert) {

					function AllObject() {
		
							this.all = [{}];
					}

					var all = new AllObject();

					var root = new BindingRoot(all);

					var element = query("#all");

					assert.strictEqual(element.children.length, 2);

					root.disconnect();
			});
		</script>
	</body>
</html>
