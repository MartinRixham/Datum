<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>For Each Tests</title>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.16.0.css">
		<script src="http://code.jquery.com/qunit/qunit-1.16.0.js"></script>
		<script src="../src/Registry.js"></script>
		<script src="../src/Subscriber.js"></script>
		<script src="../src/UniqueRoot.js"></script>
		<script src="../src/BindingRoot.js"></script>
		<script src="../src/Binding.js"></script>
		<script src="../src/ForEach.js"></script>
		<script src="../src/With.js"></script>
		<script src="../src/DomWatcher.js"></script>
		<script src="../src/Datum.js"></script>
		<script src="../src/Text.js"></script>
		<script src="../src/Value.js"></script>
		<script src="../src/Init.js"></script>
		<script src="../src/Update.js"></script>
		<script src="../src/Click.js"></script>
		<script src="../src/ViewModel.js"></script>
	</head>
	<body>
		<style>
			#qunit ~ * {
					display: none;
			}
		</style>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
		<script>
			var query = function(query) {

					return document.querySelector(query);
			};

			QUnit.module("", {

					teardown: function() {

							Subscriber.prototype = new Registry();
							Binding.prototype = new Subscriber();
							Datum.prototype = new Subscriber();
							Text.prototype = new Subscriber();
							Value.prototype = new Subscriber();
							UniqueRoot.prototype = new Subscriber();
							BindingRoot.prototype = new UniqueRoot();
							BindingRoot.With.prototype = new Subscriber();
					}
			});
		</script>
		<div id="each" data-bind="each">
			<div id="inner-each"></div>
		</div>
		<script>
			QUnit.test("Remove element when bound to empty array", function(assert) {

					function ForeachObject() {
		
							this.each = [];
					}

					var element = query("#each");

					var inner = query("#inner-each_0");

					var each = new ForeachObject();

					var root = new BindingRoot(each);

					assert.ok(!element.contains(inner));

					root.disconnect();
			});
		</script>
		<div id="one" data-bind="one">
			<div id="inner-one"></div>
		</div>
		<script>
			QUnit.test("One element when array length one", function(assert) {

					function OneObject() {
		
							this.one = [{}];
					}

					var one = new OneObject();

					var root = new BindingRoot(one);

					var element = query("#one");

					var inner = query("#inner-one_0");

					assert.ok(element.contains(inner));

					root.disconnect();
			});
		</script>
		<div id="two" data-bind="two">
			<div class="two"></div>
		</div>
		<script>
			QUnit.test("Two elements when array length two", function(assert) {

					function TwoObject() {
		
							this.two = [{}, {}];
					}

					var two = new TwoObject();

					var root = new BindingRoot(two);

					var element = query("#two");

					var childCount = element.querySelectorAll(".two").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="remove" data-bind="remove">
			<div id="remove-one"></div>
		</div>
		<script>
			QUnit.test("Remove elements when array set to null", function(assert) {

					function RemoveObject() {
		
							this.remove = [{}];
					}

					var remove = new RemoveObject();

					var element = query("#remove");

					var root = new BindingRoot(remove);

					remove.remove = null;

					assert.strictEqual(element.children.length, 0);

					root.disconnect();
			});
		</script>
		<div id="after" data-bind="after">
			<div class="after"></div>
		</div>
		<script>
			QUnit.test("Bind array after root", function(assert) {

					function AfterObject() {
		
							this.after = null;
					}

					var after = new AfterObject();

					var root = new BindingRoot(after);

					after.after = [{}, {}];

					var element = query("#after");

					var childCount = element.querySelectorAll(".after").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="reassign" data-bind="reassign">
			<div class="reassign"></div>
		</div>
		<script>
			QUnit.test("Reassign array", function(assert) {

					function ReassignObject() {
		
							this.reassign = [{}, {}];
					}

					var reassign = new ReassignObject();

					var root = new BindingRoot(reassign);

					reassign.reassign = [{}, {}];

					var element = query("#reassign");

					var childCount = element.querySelectorAll(".reassign").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="remove-all" data-bind="removeAll">
			<div id="removeOne"></div>
			<div id="removeTwo"></div>
		</div>
		<script>
			QUnit.test(
					"Remove all elements when bound to empty array",
					function(assert) {

							function RemoveAll() {
		
									this.removeAll = [];
							}

							var element = query("#remove-all");

							var each = new RemoveAll();

							var root = new BindingRoot(each);

							assert.strictEqual(element.children.length, 0);

							root.disconnect();
					});
		</script>
		<div id="all" data-bind="all">
			<div id="all-one"></div>
			<div id="all-two"></div>
		</div>
		<script>
			QUnit.test("All elements when array length one", function(assert) {

					function AllObject() {
		
							this.all = [{}];
					}

					var all = new AllObject();

					var root = new BindingRoot(all);

					var element = query("#all");

					var one = query("#all-one_0");
					var two = query("#all-two_0");

					assert.ok(element.contains(one));
					assert.ok(element.contains(two));

					root.disconnect();
			});
		</script>
		<div id="inside" data-bind="inside">
			<div id="inside-one" data-bind="innerAll"></div>
		</div>
		<script>
			QUnit.test("Apply binding inside array", function(assert) {

					function InsideObject() {
		
							this.inside = [{

								innerAll: new Binding({

									text: function() { return "Hello World"; }
								})
							}];
					}

					var inside = new InsideObject();

					var root = new BindingRoot(inside);

					var element = query("#inside-one_0");

					assert.strictEqual(element.innerHTML, "Hello World");

					root.disconnect();
			});
		</script>
		<div id="number-outer" data-bind="thenumber">
			<div id="number"></div>
		</div>
		<script>
			QUnit.test("Number ids", function(assert) {

					function NumberObject() {
		
							this.thenumber = [{}, {}];
					}

					var thenumber = new NumberObject();

					var root = new BindingRoot(thenumber);

					var element = query("#number-outer");

					var one = element.querySelector("#number_0");
					var two = element.querySelector("#number_1");

					assert.ok(one);
					assert.ok(two);

					root.disconnect();
			});
		</script>
		<div id="number-name" data-bind="name">
			<div name="name"></div>
		</div>
		<script>
			QUnit.test("Number names", function(assert) {

					function NameObject() {
		
							this.name = [{}, {}];
					}

					var name = new NameObject();

					var root = new BindingRoot(name);

					var element = query("#number-name");

					var one = element.querySelector("[name=name_0]");
					var two = element.querySelector("[name=name_1]");

					assert.ok(one);
					assert.ok(two);

					root.disconnect();
			});
		</script>
		<div id="subnumber" data-bind="subnumber">
			<div>
				<div id="inner-subnumber"></div>
			</div>
		</div>
		<script>
			QUnit.test("Number ids on subelements", function(assert) {

					function SubnumberObject() {
		
							this.subnumber = [{}];
					}

					var subnumber = new SubnumberObject();

					var root = new BindingRoot(subnumber);

					var element = query("#subnumber");

					var one = element.querySelector("#inner-subnumber_0");

					assert.ok(one);
					assert.ok(two);

					root.disconnect();
			});
		</script>
		<div id="push" data-bind="push">
			<div class="push"></div>
		</div>
		<script>
			QUnit.test("Add element when object pushed to array", function(assert) {

					function PushObject() {
		
							this.push = [{}];
					}

					var push = new PushObject();

					var root = new BindingRoot(push);

					push.push.push({});

					assert.strictEqual(push.push.length, 2);

					var element = query("#push");

					var childCount = element.querySelectorAll(".push").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<span id="span" data-bind="span">
			<div></div>
		</span>
		<script>
			QUnit.test("Two elements when array length two", function(assert) {

					function SpanObject() {
		
							this.span = [{}, {}];
					}

					var span = new SpanObject();

					var root = new BindingRoot(span);

					var element = query("#span");

					var childCount = element.querySelectorAll("span").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="string" data-bind="str">
			<div class="string"></div>
		</div>
		<script>
			QUnit.test("Bind to string array", function(assert) {

					function StringObject() {
		
							this.str = ["thingy", "sumpt"];
					}

					var str = new StringObject();

					var root = new BindingRoot(str);

					var element = query("#string");

					var childCount = element.querySelectorAll(".string").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="pop" data-bind="pop">
			<div class="pop"></div>
		</div>
		<script>
			QUnit.test("Remove element when object popped from array", function(assert) {

					function PopObject() {
		
							this.pop = [{}, {}];
					}

					var pop = new PopObject();

					var root = new BindingRoot(pop);

					pop.pop.pop();

					assert.strictEqual(pop.pop.length, 1);

					var element = query("#pop");

					var childCount = element.querySelectorAll(".pop").length;

					assert.strictEqual(childCount, 1);

					root.disconnect();
			});
		</script>
		<div id="shift" data-bind="shift">
			<div class="shift" data-bind="shiftText"></div>
		</div>
		<script>
			QUnit.test("Remove first element on array shift", function(assert) {

					function ShiftObject() {
		
							this.shift = 
								[
									{}, 
									{ shiftText: new Text(function() { return "Hello World"; }) }
								];
					}

					var shift = new ShiftObject();

					var root = new BindingRoot(shift);

					shift.shift.shift();

					assert.strictEqual(shift.shift.length, 1);

					var element = query("#shift");

					children = element.querySelectorAll(".shift");

					assert.strictEqual(children.length, 1);

					assert.strictEqual(children[0].innerHTML, "Hello World");

					root.disconnect();
			});
		</script>
		<div id="unshift" data-bind="unshift">
			<div class="unshift" data-bind="shiftText"></div>
		</div>
		<script>
			QUnit.test("Add element to front of array on unshift", function(assert) {

					function UnshfitObject() {
		
							this.unshift = [{}];
					}

					var unshift = new UnshfitObject();

					var root = new BindingRoot(unshift);

					unshift.unshift.unshift({ 

						shiftText: new Text(function() { return "Hello World"; }) 
					});

					assert.strictEqual(unshift.unshift.length, 2);

					var element = query("#unshift");

					var children = element.querySelectorAll(".unshift");

					assert.strictEqual(children.length, 2);

					assert.strictEqual(children[0].innerHTML, "Hello World");

					root.disconnect();
			});
		</script>
		<div id="null" data-bind="nullProperty">
			<div class="null"></div>
		</div>
		<script>
			QUnit.test("Bind array with null element", function(assert) {

					function NullObject() {
		
							this.nullProperty = [null, {}];
					}

					var nullObject = new NullObject();

					var root = new BindingRoot(nullObject);

					var element = query("#null");

					var childCount = element.querySelectorAll(".null").length;

					assert.strictEqual(childCount, 1);

					root.disconnect();
			});
		</script>
		<div id="splice-remove" data-bind="spliceRemove">
			<div class="splice-remove"></div>
		</div>
		<script>
			QUnit.test("Remove element with splice", function(assert) {

					function SpliceRemoveObject() {
		
							this.spliceRemove = [{}, {}, {}];
					}

					var spliceRemove = new SpliceRemoveObject();

					var root = new BindingRoot(spliceRemove);
					
					spliceRemove.spliceRemove.splice(1, 1);
					
					assert.strictEqual(spliceRemove.spliceRemove.length, 2);

					var element = query("#splice-remove");

					var childCount = element.querySelectorAll(".splice-remove").length;

					assert.strictEqual(childCount, 2);

					root.disconnect();
			});
		</script>
		<div id="splice-remove-two" data-bind="spliceRemoveTwo">
			<div class="splice-remove-two"></div>
		</div>
		<script>
			QUnit.test("Remove two elements with splice", function(assert) {

					function SpliceRemoveTwoObject() {
		
							this.spliceRemoveTwo = [{}, {}, {}];
					}

					var spliceRemoveTwo = new SpliceRemoveTwoObject();

					var root = new BindingRoot(spliceRemoveTwo);
					
					spliceRemoveTwo.spliceRemoveTwo.splice(1, 2);
					
					assert.strictEqual(spliceRemoveTwo.spliceRemoveTwo.length, 1);

					var element = query("#splice-remove-two");

					var childCount =
							element.querySelectorAll(".splice-remove-two").length;

					assert.strictEqual(childCount, 1);

					root.disconnect();
			});
		</script>
	</body>
</html>
